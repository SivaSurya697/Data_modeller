{% extends 'base.html' %}
{% block title %}Change Sets · Data Modeller{% endblock %}
{% block content %}
<h2>Change Sets</h2>
<form method="post">
    <label for="domain_id">Domain</label>
    <select id="domain_id" name="domain_id" required>
        <option value="" disabled selected>Select a domain</option>
        {% for domain in domains %}
            <option value="{{ domain.id }}">{{ domain.name }}</option>
        {% endfor %}
    </select>

    <label for="title">Title</label>
    <input id="title" name="title" type="text" required>

    <label for="summary">Summary</label>
    <textarea id="summary" name="summary" rows="4" required></textarea>
    <button type="submit">Record Change</button>
</form>

<div class="grid-2 changeset-diff-view">
    <div>
        <h3>Available Change Sets</h3>
        {% if changesets %}
        <ul class="changeset-list">
            {% for item in changesets %}
                <li>
                    <div class="changeset-row">
                        <div class="changeset-meta">
                            <strong>#{{ item.id }} · {{ item.title }}</strong>
                            <span class="state-badge state-{{ item.state }}">{{ item.state.replace('_', ' ')|title }}</span>
                            <p class="muted">{{ item.domain.name }}</p>
                        </div>
                        <button type="button"
                                hx-get="{{ url_for('changesets_api.get_changeset', change_set_id=item.id) }}"
                                hx-target="#cs-detail"
                                hx-swap="innerHTML">
                            View
                        </button>
                    </div>
                </li>
            {% endfor %}
        </ul>
        {% else %}
        <p>No change sets captured.</p>
        {% endif %}
    </div>
    <div id="cs-detail">
        <p>Select a change set to view proposed changes.</p>
    </div>
</div>
{% endblock %}

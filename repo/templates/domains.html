{% extends 'base.html' %}
{% block title %}Domains · Data Modeller{% endblock %}
{% block content %}
<h2>Domains</h2>
<form method="post">
    <label for="name">Domain name</label>
    <input id="name" name="name" type="text" required>
    <label for="description">Description</label>
    <textarea id="description" name="description" rows="4" required></textarea>
    <button type="submit">Create Domain</button>
</form>

{% if domains %}
<table class="table">
    <thead>
    <tr>
        <th>Name</th>
        <th>Description</th>
        <th>Entities</th>
        <th>Review tasks</th>
    </tr>
    </thead>
    <tbody>
    {% for domain in domains %}
        <tr>
            <td>{{ domain.name }}</td>
            <td>{{ domain.description }}</td>
            <td>
                {% if domain.entities %}
                    <ul>
                        {% for entity in domain.entities %}
                            <li>{{ entity.name }}{% if entity.description %} – {{ entity.description }}{% endif %}</li>
                        {% endfor %}
                    </ul>
                {% else %}
                    No entities yet.
                {% endif %}
            </td>
            <td>
                {% if domain.created_review_tasks %}
                    <ul class="review-tasks">
                        {% for task in domain.created_review_tasks %}
                            <li>
                                <strong>{{ task.title }}</strong>
                                <div class="task-target">Impacted domain: {{ task.target_domain.name }}</div>
                                <p>{{ task.details }}</p>
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    No review tasks generated.
                {% endif %}
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>
{% else %}
<p>No domains defined.</p>
{% endif %}
{% endblock %}

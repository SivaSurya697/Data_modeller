{% extends "base.html" %}

{% block title %}Quality Dashboard{% endblock %}

{% block content %}
<section class="quality-dashboard">
    <h2>Quality Dashboard</h2>
    <form method="get" class="quality-selector">
        <label for="domain_id">Domain</label>
        <select name="domain_id" id="domain_id" onchange="this.form.submit()">
            {% for domain in domains %}
                <option value="{{ domain.id }}" {% if selected_domain_id == domain.id %}selected{% endif %}>{{ domain.name }}</option>
            {% endfor %}
        </select>
        <noscript>
            <button type="submit">Analyze</button>
        </noscript>
    </form>

    {% if analysis %}
    <div class="coverage-summary">
        <h3>MECE Coverage</h3>
        <div class="coverage-badges">
            <span class="badge">MECE Score: {{ (analysis.mece_score * 100)|round(1) }}%</span>
            <span class="badge">Collisions: {{ analysis.collisions|length }}</span>
            <span class="badge">Uncovered Terms: {{ analysis.uncovered_terms|length }}</span>
        </div>
        <div class="coverage-grid">
            <div>
                <h4>Collisions</h4>
                {% if analysis.collisions %}
                    <ul class="issues">
                        {% for item in analysis.collisions %}
                        <li>
                            <strong>{{ item.attribute }}</strong>
                            <small>({{ item.entities | join(', ') }})</small>
                        </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>No collisions detected.</p>
                {% endif %}
            </div>
            <div>
                <h4>Uncovered Ontology Terms</h4>
                {% if analysis.uncovered_terms %}
                    <ul class="gaps">
                        {% for item in analysis.uncovered_terms %}
                        <li>
                            <strong>{{ item.entity }}</strong>
                            {% if item.missing_attrs %}
                                <small>missing {{ item.missing_attrs | join(', ') }}</small>
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>All tracked ontology entities and attributes are covered.</p>
                {% endif %}
            </div>
            <div>
                <h4>Naming Suggestions</h4>
                {% if analysis.naming_suggestions %}
                    <table class="naming-suggestions">
                        <thead>
                            <tr><th>Entity</th><th>Current</th><th>Suggested</th></tr>
                        </thead>
                        <tbody>
                        {% for item in analysis.naming_suggestions %}
                            <tr>
                                <td>{{ item.entity }}</td>
                                <td>{{ item.from }}</td>
                                <td>{{ item.to }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <p>No naming suggestions at this time.</p>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
</section>
{% endblock %}
